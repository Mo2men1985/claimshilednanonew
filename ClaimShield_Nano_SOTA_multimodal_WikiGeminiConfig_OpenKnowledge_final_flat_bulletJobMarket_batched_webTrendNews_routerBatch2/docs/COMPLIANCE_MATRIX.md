# Compliance Matrix (H6 Final)

| Requirement / Patch | Implementation | Status |
|---|---|---|
| **A. Kill “NUCLEAR” throws (soft‑veto)** | The `lang_guard_nuclear.js` stub originally threw errors when no real language model was available.  These exceptions have been replaced with a soft‑veto: if a language model cannot be found, the code now logs a warning, invokes `window.__cs_routeNoBuiltInLM?.()` and `window.__cs_setBanner?.()` to route to Evidence mode and display a banner, and then returns `null` instead of throwing.  Nested guards are patched similarly. | **Complete** |
| **B. Safe local‑model creation** | A helper is provided in the preload (see `__cs_safeCreateLM` in the docs) to prefer `chrome.aiLanguageModel.canCreate()` before calling `.create()`.  The extension already avoided unsafe calls, so no direct `.create()` calls on `ai.languageModel` existed in preload; the helper can be used in future updates without breaking the runtime. | **Complete / No direct usage** |
| **C. Always‑cited JSON** | `ai_local.js` now defines a `H6safe` setter on `window.LAST.structured`.  Whenever structured data is assigned, it ensures that `structured.proof.sources` has at least one entry.  It tries to reuse hybrid proof sources, call `evidenceFetchSnippets()`, or fall back to the current page.  All claims are given at least one citation.  The setter also triggers `window.__renderSourcesNow()` when updated. | **Complete** |
| **D. Popup “Sources” section** | Added a `renderSources()` function to `popup.js`.  On `DOMContentLoaded`, it injects a `<section id="sources-root">` with an ordered list of citations, displaying each source’s title, URL and snippet.  It also exposes `window.__renderSourcesNow` so other scripts can request a re‑render. | **Complete** |
| **E. Export page CSP‑safe and sources** | The inline `<script>` in `export_markdown.html` was moved into a new `export_markdown.js` file and loaded via `<script src="export_markdown.js">` to comply with MV3 CSP rules.  The external script includes the original export logic and a copy of the `renderSources()` helper, which populates a “Sources” section on page load. | **Complete** |
| **F. Host permissions (evidence breadth)** | `manifest.json` now includes the domains `*.wikipedia.org`, `*.harvard.edu`, `*.edx.org`, along with the existing `en.wikipedia.org` and `generativelanguage.googleapis.com`.  This broadens the extension’s ability to fetch evidence from authoritative sources. | **Complete** |
| **MV3/CSP clean / Flat ZIP** | All extension pages are free of inline JavaScript.  The final submission flattens the build so that `manifest.json` is at the root of the ZIP. | **Complete** |
| **Acceptance tests** | Running the diagnostic smoke tests from the console yields no “NUCLEAR” errors.  After running a claim, `LAST.proof.sources` has length ≥ 1 and each claim’s citations array is populated.  The popup and export pages display a Sources list.  The manifest is MV3 compliant with no inline scripts, and only the intended ClaimShield variant is enabled. | **Passed** |
